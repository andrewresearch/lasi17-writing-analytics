{"paragraphs":[{"text":"%md\n> Discuss this session online in the [LASI-17 Room](https://gitter.im/writing-analytics/LASI-17) of the Gitter [Writing Analytics Community](https://gitter.im/writing-analytics).","dateUpdated":"2017-06-02T18:44:54+1000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<blockquote>\n  <p>Discuss this session online in the <a href=\"https://gitter.im/writing-analytics/LASI-17\">LASI-17 Room</a> of the Gitter <a href=\"https://gitter.im/writing-analytics\">Writing Analytics Community</a>.</p>\n</blockquote>\n</div>"}]},"apps":[],"jobName":"paragraph_1496393094963_2102656784","id":"20170602-152031_858551274","dateCreated":"2017-06-02T18:44:54+1000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5455"},{"title":"Load support resources","text":"//Access Local Filesystem\n\nobject LocalIO {\n    \n    import java.io.File\n    import scala.io.Source\n    \n    val IN_DIR_NAME = \"/input_files\"\n    val OUT_DIR_NAME = \"/output_files\"\n    \n    private val _thisDir:String = new File(\".\").getCanonicalPath\n    private var _workingDir:String = _thisDir\n\n    lazy val inputFileDir = _workingDir+IN_DIR_NAME\n    lazy val outputFileDir = _workingDir+OUT_DIR_NAME\n    \n    val visibleFile = (file:File) => !file.isHidden\n    val notDirectory = (file:File) => !file.isDirectory\n    val textFile = (file:File) => file.getName.split('.').last.contains(\"txt\")\n    \n    def setWorkingDir(directoryPath:String) = {\n        println(s\"Setting the working directory to: $directoryPath\")\n        this._workingDir = directoryPath\n    }\n    \n    def directoryFromString(directory:String):Option[File] = {\n         val newDir = new File(directory)\n         if (newDir.exists && newDir.isDirectory) Some(newDir)\n         else None\n    }\n    \n    def listFiles(directory:String):List[File] = {\n        directoryFromString(directory) match {\n            case Some(dir) => dir.listFiles.toList\n            case None => List[File]()\n        }\n    }\n    \n    def workingDirFiles = listFiles(_workingDir)\n    \n    def readFile(file:File) = {\n        val source = Source.fromFile(file.getCanonicalPath)\n        try {\n            source.getLines.mkString(\"\\n\\n\")\n        } finally {\n            source.close\n        }\n    }\n}\n\n//Classes for TAP data\ncase class Message(message:String)\n  //type Results[T] = List[T]\n  case class Result[T](message:String,results:T)\n  case class Tags(lemmas:List[String] = List(),posTags:List[String] = List())\n  case class Sentence(text:String,tokens:List[String],tags:Tags = Tags())\n  case class Section(sentences:List[Sentence])\n  case class Document(sections:List[Section])\n\n//The TapIO class\ncase class TapIO(server:String = \"http://localhost:8080\") {\n    \n    //Import some helper libraries\n    import scalaj.http._    // to manage http connection to TAP\n    import org.json4s._     // to serialise and deserialise JSON\n    import org.json4s.jackson.Serialization\n    import org.json4s.jackson.Serialization.{read, write}\n    \n    implicit val defaultFormats = Serialization.formats(NoTypeHints)\n    \n    val API_VERSION = \"v1\"\n    lazy val API_URL = server+\"/\"+API_VERSION\n    lazy val HEALTH_URL = API_URL+\"/health\"\n    lazy val CLEAN_URL = API_URL+\"/analyse/text/clean\"\n    lazy val STRUCTURE_URL = API_URL+\"/analyse/text/structure\"\n    \n    def serverDetails = Http(API_URL).asString\n\n    def getHealthMessage(debug:Boolean = false) = {\n        println(s\"Connecting to $HEALTH_URL\")\n        val response = Http(HEALTH_URL).asString\n        if(debug) println(response)\n        read[Message](response.body)\n    }\n\n    def serverIsHealthy = {\n        try { getHealthMessage().message==\"ok\" }\n        catch { case e:Exception => {\n                println(s\"There was a problem with the server: $e\")\n                false }\n        }\n    }\n    \n    def cleanText(text:String) = {\n    //println(s\"Cleaning text: $text\")\n    val response = Http(CLEAN_URL).postData(text).header(\"content-type\", \"application/json\").asString\n    //println(response)\n    read[Result[List[String]]](response.body)\n  }\n\n  def getStructure(text:String) = {\n    //println(s\"Getting structure for text: $text\")\n    val response = Http(STRUCTURE_URL).postData(text).header(\"content-type\", \"application/json\").asString\n    //println(response)\n    read[Result[Document]](response.body)\n  }\n}\n\nval tapServer = TapIO()\n\n\n","dateUpdated":"2017-06-02T18:44:54+1000","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1496393094964_2100733040","id":"20170602-152308_1200100722","dateCreated":"2017-06-02T18:44:54+1000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5456"},{"text":"def sampleText = try {\n    //First, try and read in the file\n    val inputTextFiles = LocalIO.listFiles(LocalIO.inputFileDir).filter(LocalIO.textFile)\n    val text = LocalIO.readFile(inputTextFiles.find(_.getName.contains(\"sample\")).get)\n    //Next, post the text to TAP for cleaning\n    val cleanedText = tapServer.cleanText(text).results\n    //If successful return the cleaned text\n    Some(cleanedText)\n} catch {\n    case(e:Exception) => {\n        println(s\"ERROR: There was a problem reading the file. $e\")\n        None\n    }\n}","dateUpdated":"2017-06-02T18:44:54+1000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1496393094966_2101502538","id":"20170602-153056_702537100","dateCreated":"2017-06-02T18:44:54+1000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5460"},{"text":"pharmacyText.getOrElse(List()).foreach(println(_))","dateUpdated":"2017-06-02T18:44:54+1000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1496393094966_2101502538","id":"20170602-153125_1340194947","dateCreated":"2017-06-02T18:44:54+1000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5462"},{"user":"admin","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1496393235819_-1063675066","id":"20170602-184715_680410316","dateCreated":"2017-06-02T18:47:15+1000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:6387"}],"name":"Template","id":"2CJFTX3SP","angularObjects":{"2CGWV1MGK:shared_process":[],"2CEVAN2GV:shared_process":[],"2CGJUBZ7V:shared_process":[],"2CFA6A5V1:shared_process":[],"2CG7VTQCX:shared_process":[],"2CEG2J2DN:shared_process":[],"2CEHG1843:shared_process":[],"2CEZJ1FFZ:shared_process":[],"2CG3DREEN:shared_process":[],"2CHBDJGUA:shared_process":[],"2CHGWK3QR:shared_process":[],"2CF1G5GT2:shared_process":[],"2CEFSXDFW:shared_process":[],"2CH8ZF27R:shared_process":[],"2CH1RZ17X:shared_process":[],"2CFKZEYRE:shared_process":[],"2CH9D63SV:shared_process":[],"2CE3V4W48:shared_process":[],"2CGKC4T26:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}